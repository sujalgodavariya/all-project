<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>My Music ‚Äî YouTube Playlist Manager</title>
  <meta name="theme-color" content="#121419" />
  <style>
    /* Base layout */
    :root {
      --bg: #0b0c10;
      --panel: #121419;
      --panel-2: #161a22;
      --text: #e3e6eb;
      --muted: #97a0ad;
      --brand: #7c5cff;
      --brand-2: #5a35ff;
      --accent: #21d4fd;
      --danger: #ff5c7c;
      --success: #5cff8f;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --safe-area-inset-top: env(safe-area-inset-top);
      --safe-area-inset-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }

    body {
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #0b0c10 0%, #0e1117 100%);
      color: var(--text);
      line-height: 1.6;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
    }

    /* Header */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 16px;
      align-items: center;
      padding: 16px clamp(16px, 5vw, 32px);
      padding-top: calc(16px + var(--safe-area-inset-top));
      background: rgba(10, 12, 16, 0.8);
      backdrop-filter: saturate(140%) blur(10px);
      -webkit-backdrop-filter: saturate(140%) blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .brand { display: inline-flex; align-items: center; gap: 12px; }
    .logo { font-size: 24px; }
    .title { font-size: 18px; margin: 0; font-weight: 700; letter-spacing: 0.3px; }

    .add-form {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      width: min(740px, 100%);
    }
    .add-form input {
      width: 100%;
      height: 44px; /* Increased for better touch */
      padding: 0 16px; /* More padding for mobile */
      color: var(--text);
      background: var(--panel-2);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      outline: none;
      font-size: 16px; /* Larger font for mobile */
      -webkit-appearance: none; /* Remove iOS shadow */
    }
    .add-form input::placeholder { color: var(--muted); }
    .add-form input:focus { border-color: var(--brand); }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 20px;
      padding: 20px clamp(16px, 5vw, 32px);
      align-items: start;
    }

    /* Sidebar */
    .sidebar {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
      height: fit-content;
      max-height: 80vh;
    }
    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 12px 8px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .sidebar-header h2 { font-size: 14px; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); margin: 0; }
    .sidebar-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    
    .playlist-management {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      padding: 0 8px;
    }

    .playlist { list-style: none; margin: 0; padding: 8px; max-height: calc(80vh - 180px); overflow: auto; }
    .playlist-item {
      display: grid;
      grid-template-columns: 28px 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 12px; /* More padding for touch */
      border-radius: 10px;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s ease;
      touch-action: manipulation; /* Better touch behavior */
    }
    .playlist-item:hover { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.06); }
    .playlist-item.active { background: rgba(124,92,255,0.12); border-color: rgba(124,92,255,0.35); }
    .playlist-index { color: var(--muted); font-size: 12px; width: 28px; text-align: center; }
    .playlist-title { font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .playlist-actions { display: flex; gap: 6px; opacity: 0.6; transition: opacity 0.2s ease; }
    .playlist-item:hover .playlist-actions { opacity: 1; }

    /* Player */
    .player-area {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .player-wrapper { width: 100%; }
    .player-aspect { 
      position: relative; 
      width: 100%; 
      border-radius: 12px; 
      overflow: hidden; 
      background: #000; 
    }
    .player-aspect::before { 
      content: ""; 
      display: block; 
      padding-top: 56.25%; 
    }
    .player { 
      position: absolute; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      border: none;
    }

    .now-playing { 
      margin: 14px 2px 4px; 
      color: var(--muted); 
      font-size: 13px; 
      min-height: 18px; 
      padding: 8px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }

    .controls { 
      display: flex; 
      gap: 10px; 
      align-items: center; 
      margin-top: 8px; 
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Buttons */
    .btn {
      height: 44px; /* Larger for mobile touch */
      min-height: 44px;
      padding: 0 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, #1a1f29 0%, #11151c 100%);
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s ease;
      touch-action: manipulation; /* Better touch behavior */
      user-select: none;
    }
    .btn:hover { border-color: rgba(255,255,255,0.16); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); background: #11151c; }
    .btn.primary {
      background: linear-gradient(180deg, var(--brand) 0%, var(--brand-2) 100%);
      border-color: rgba(124,92,255,0.6);
    }
    .btn.ghost { background: transparent; }
    .btn.circle { 
      width: 50px; /* Slightly larger for mobile */
      height: 50px; 
      padding: 0; 
      border-radius: 50%; 
      font-size: 18px; 
      display: inline-grid; 
      place-items: center; 
    }
    .btn.circle.active {
      background: linear-gradient(180deg, var(--brand) 0%, var(--brand-2) 100%);
      border-color: rgba(124,92,255,0.6);
    }

    /* Footer */
    .app-footer { 
      color: var(--muted); 
      text-align: center; 
      padding: 24px; 
      font-size: 12px; 
      margin-top: 40px;
      padding-bottom: calc(24px + var(--safe-area-inset-bottom));
    }

    /* Mobile-specific styles */
    .mobile-controls {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--panel);
      border-top: 1px solid rgba(255,255,255,0.06);
      padding: 12px 16px;
      padding-bottom: calc(12px + var(--safe-area-inset-bottom));
      z-index: 100;
      justify-content: space-between;
      align-items: center;
    }

    .mobile-now-playing {
      flex: 1;
      margin: 0 12px;
      font-size: 14px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar { order: 2; max-height: none; }
      .player-area { order: 1; }
    }

    @media (max-width: 768px) {
      .app-header { 
        grid-template-columns: 1fr; 
        justify-items: center;
        padding-top: calc(12px + var(--safe-area-inset-top));
      }
      .add-form { width: 100%; }
      
      .sidebar {
        max-height: 40vh;
      }
      
      .playlist {
        max-height: 30vh;
      }
    }

    @media (max-width: 520px) {
      .add-form { grid-template-columns: 1fr; }
      .controls { flex-wrap: wrap; }
      .playlist-item { grid-template-columns: 24px 1fr auto; gap: 8px; }
      .playlist-management { flex-wrap: wrap; justify-content: center; }
      
      .player-area {
        padding: 12px;
      }
      
      .controls {
        gap: 8px;
      }
      
      .btn.circle {
        width: 44px;
        height: 44px;
      }
      
      /* Show mobile controls when video is playing */
      .mobile-controls {
        display: flex;
      }
    }

    /* Loading state */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--brand);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Messages */
    .error-message {
      color: var(--danger);
      font-size: 14px;
      padding: 8px;
      text-align: center;
      background: rgba(255,92,124,0.1);
      border-radius: 8px;
      margin-top: 10px;
    }
    
    .success-message {
      color: var(--success);
      font-size: 14px;
      padding: 8px;
      text-align: center;
      background: rgba(92,255,143,0.1);
      border-radius: 8px;
      margin-top: 10px;
    }

    /* Playlist selector */
    .playlist-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding: 0 8px;
    }
    
    .playlist-selector select {
      flex: 1;
      height: 40px;
      background: var(--panel-2);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 0 12px;
      font-size: 14px;
      -webkit-appearance: none;
    }
    
    /* Swipe actions for playlist items */
    .playlist-item {
      position: relative;
      overflow: hidden;
    }
    
    .swipe-actions {
      position: absolute;
      top: 0;
      right: -70px;
      height: 100%;
      display: flex;
      align-items: center;
      transition: right 0.3s ease;
    }
    
    .playlist-item.swiped .swipe-actions {
      right: 0;
    }
    
    .swipe-delete {
      height: 100%;
      width: 70px;
      background: var(--danger);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo">üéµ</span>
      <h1 class="title">My Music</h1>
    </div>

    <form id="add-form" class="add-form" autocomplete="off">
      <input id="youtube-input" type="text" inputmode="url" placeholder="Paste YouTube URL or ID (e.g., dQw4w9WgXcQ)" aria-label="YouTube URL or ID" required />
      <button type="submit" class="btn primary">Add</button>
    </form>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Playlist Manager</h2>
        <div class="sidebar-actions">
          <button id="clear-playlist" class="btn ghost" title="Clear playlist">Clear</button>
        </div>
      </div>
      
      <div class="playlist-selector">
        <select id="playlist-select">
          <option value="default">Default Playlist</option>
        </select>
        <button id="playlist-action" class="btn primary">‚ãÆ</button>
      </div>
      
      <div class="playlist-management">
        <button id="create-playlist" class="btn ghost" title="Create new playlist">New</button>
        <button id="rename-playlist" class="btn ghost" title="Rename playlist">Rename</button>
        <button id="delete-playlist" class="btn ghost" title="Delete playlist">Delete</button>
      </div>
      
      <ul id="playlist" class="playlist" aria-label="Playlist"></ul>
    </aside>

    <section class="player-area">
      <div class="player-wrapper">
        <div class="player-aspect">
          <div id="player" class="player"></div>
        </div>
      </div>

      <div class="now-playing" id="now-playing" aria-live="polite">Add a video to get started</div>

      <div class="controls">
        <button id="prev" class="btn circle" title="Previous">‚èÆ</button>
        <button id="play-pause" class="btn circle" title="Play/Pause">‚ñ∂Ô∏è</button>
        <button id="next" class="btn circle" title="Next">‚è≠</button>
        <button id="shuffle" class="btn circle" title="Shuffle">üîÄ</button>
        <button id="repeat" class="btn circle" title="Repeat">üîÅ</button>
      </div>
    </section>
  </main>
  
  <!-- Mobile controls that stay at the bottom -->
  <div class="mobile-controls" id="mobile-controls">
    <button id="mobile-play-pause" class="btn circle" title="Play/Pause">‚ñ∂Ô∏è</button>
    <div class="mobile-now-playing" id="mobile-now-playing">Add a video to get started</div>
    <button id="mobile-next" class="btn circle" title="Next">‚è≠</button>
  </div>

  <footer class="app-footer">
    <span>Built with ‚ù§Ô∏è using YouTube IFrame API</span>
  </footer>

  <script>
    // Global variables
    let player;
    let playlists = {
      'default': []
    };
    let currentPlaylist = 'default';
    let currentVideoIndex = 0;
    let isShuffle = false;
    let isRepeat = false;
    let isPlayerReady = false;
    let touchStartX = 0;
    let currentSwipeItem = null;

    // DOM elements
    const addForm = document.getElementById('add-form');
    const youtubeInput = document.getElementById('youtube-input');
    const playlistElement = document.getElementById('playlist');
    const nowPlayingElement = document.getElementById('now-playing');
    const mobileNowPlayingElement = document.getElementById('mobile-now-playing');
    const prevButton = document.getElementById('prev');
    const playPauseButton = document.getElementById('play-pause');
    const nextButton = document.getElementById('next');
    const shuffleButton = document.getElementById('shuffle');
    const repeatButton = document.getElementById('repeat');
    const clearButton = document.getElementById('clear-playlist');
    const playlistSelect = document.getElementById('playlist-select');
    const playlistAction = document.getElementById('playlist-action');
    const createPlaylistBtn = document.getElementById('create-playlist');
    const renamePlaylistBtn = document.getElementById('rename-playlist');
    const deletePlaylistBtn = document.getElementById('delete-playlist');
    const mobilePlayPauseButton = document.getElementById('mobile-play-pause');
    const mobileNextButton = document.getElementById('mobile-next');
    const mobileControls = document.getElementById('mobile-controls');

    // Initialize the YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // YouTube API ready callback
    window.onYouTubeIframeAPIReady = function() {
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        playerVars: {
          'playsinline': 1,
          'modestbranding': 1,
          'rel': 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange,
          'onError': onPlayerError
        }
      });
    };

    // Player event handlers
    function onPlayerReady(event) {
      isPlayerReady = true;
      console.log('YouTube player is ready');
      
      // Load the first video if we have one
      if (playlists[currentPlaylist].length > 0) {
        loadVideoById(playlists[currentPlaylist][0].id);
      }
    }

    function onPlayerStateChange(event) {
      // When video ends, play next if not repeating
      if (event.data === YT.PlayerState.ENDED) {
        if (isRepeat) {
          player.playVideo();
        } else {
          playNextVideo();
        }
      }
      
      // Update play/pause button
      if (event.data === YT.PlayerState.PLAYING) {
        playPauseButton.textContent = '‚è∏';
        mobilePlayPauseButton.textContent = '‚è∏';
        mobileControls.style.display = 'flex';
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
        playPauseButton.textContent = '‚ñ∂Ô∏è';
        mobilePlayPauseButton.textContent = '‚ñ∂Ô∏è';
      }
    }

    function onPlayerError(event) {
      console.error('YouTube player error:', event.data);
      nowPlayingElement.innerHTML = `<span class="error-message">Error playing video. Trying next video...</span>`;
      mobileNowPlayingElement.textContent = 'Error playing video';
      
      // Try to play the next video on error
      setTimeout(playNextVideo, 2000);
    }

    // Extract YouTube video ID from various URL formats
    function extractVideoId(url) {
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
      const match = url.match(regExp);
      
      if (match && match[2].length === 11) {
        return match[2];
      }
      
      // If it's not a URL, maybe it's directly a video ID
      if (url.length === 11 && !url.includes('/') && !url.includes('.')) {
        return url;
      }
      
      return null;
    }

    // Fetch video title from YouTube
    async function fetchVideoTitle(videoId) {
      try {
        // Using a proxy to avoid CORS issues
        const response = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`);
        const data = await response.json();
        
        if (data.title) {
          return data.title;
        } else {
          throw new Error('Title not found');
        }
      } catch (error) {
        console.error('Error fetching video title:', error);
        return `Video ${videoId}`;
      }
    }

    // Add video to playlist
    async function addVideoToPlaylist(videoId) {
      // Show loading state
      nowPlayingElement.innerHTML = '<div class="loading"></div> Fetching video info...';
      mobileNowPlayingElement.textContent = 'Fetching video info...';
      
      try {
        // Fetch the actual video title
        const videoTitle = await fetchVideoTitle(videoId);
        
        // Add to playlist array
        playlists[currentPlaylist].push({
          id: videoId,
          title: videoTitle
        });
        
        // Save to localStorage
        savePlaylists();
        
        // Update UI
        renderPlaylist();
        
        // If this is the first video, play it
        if (playlists[currentPlaylist].length === 1 && isPlayerReady) {
          loadVideoById(videoId);
        }
        
        // Clear input
        youtubeInput.value = '';
        
        // Show success message
        nowPlayingElement.innerHTML = `<span class="success-message">"${videoTitle}" added to playlist!</span>`;
        mobileNowPlayingElement.textContent = `"${videoTitle}" added!`;
        setTimeout(updateNowPlaying, 3000);
      } catch (error) {
        console.error('Error adding video:', error);
        nowPlayingElement.innerHTML = `<span class="error-message">Error adding video. Please try again.</span>`;
        mobileNowPlayingElement.textContent = 'Error adding video';
      }
    }

    // Load video by ID
    function loadVideoById(videoId) {
      if (!isPlayerReady) return;
      
      player.loadVideoById(videoId);
      currentVideoIndex = playlists[currentPlaylist].findIndex(video => video.id === videoId);
      updateNowPlaying();
    }

    // Play next video
    function playNextVideo() {
      if (playlists[currentPlaylist].length === 0) return;
      
      if (isShuffle) {
        // Play random video (not the same as current)
        let nextIndex;
        do {
          nextIndex = Math.floor(Math.random() * playlists[currentPlaylist].length);
        } while (nextIndex === currentVideoIndex && playlists[currentPlaylist].length > 1);
        
        currentVideoIndex = nextIndex;
      } else {
        // Play next video in sequence
        currentVideoIndex = (currentVideoIndex + 1) % playlists[currentPlaylist].length;
      }
      
      loadVideoById(playlists[currentPlaylist][currentVideoIndex].id);
    }

    // Play previous video
    function playPreviousVideo() {
      if (playlists[currentPlaylist].length === 0) return;
      
      currentVideoIndex = (currentVideoIndex - 1 + playlists[currentPlaylist].length) % playlists[currentPlaylist].length;
      loadVideoById(playlists[currentPlaylist][currentVideoIndex].id);
    }

    // Toggle play/pause
    function togglePlayPause() {
      if (!isPlayerReady || playlists[currentPlaylist].length === 0) return;
      
      if (player.getPlayerState() === YT.PlayerState.PLAYING) {
        player.pauseVideo();
        playPauseButton.textContent = '‚ñ∂Ô∏è';
        mobilePlayPauseButton.textContent = '‚ñ∂Ô∏è';
      } else {
        player.playVideo();
        playPauseButton.textContent = '‚è∏';
        mobilePlayPauseButton.textContent = '‚è∏';
        mobileControls.style.display = 'flex';
      }
    }

    // Update now playing info
    function updateNowPlaying() {
      if (playlists[currentPlaylist].length === 0) {
        nowPlayingElement.textContent = 'Add a video to get started';
        mobileNowPlayingElement.textContent = 'Add a video to get started';
        mobileControls.style.display = 'none';
        return;
      }
      
      const currentVideo = playlists[currentPlaylist][currentVideoIndex];
      nowPlayingElement.textContent = `Now playing: ${currentVideo.title}`;
      mobileNowPlayingElement.textContent = currentVideo.title;
    }

    // Render playlist UI
    function renderPlaylist() {
      playlistElement.innerHTML = '';
      
      playlists[currentPlaylist].forEach((video, index) => {
        const li = document.createElement('li');
        li.className = `playlist-item ${index === currentVideoIndex ? 'active' : ''}`;
        li.dataset.index = index;
        
        li.innerHTML = `
          <span class="playlist-index">${index + 1}</span>
          <div class="playlist-title">${video.title}</div>
          <div class="playlist-actions">
            <button class="btn ghost remove-btn" title="Remove">‚úï</button>
          </div>
          <div class="swipe-actions">
            <div class="swipe-delete">Delete</div>
          </div>
        `;
        
        // Add touch events for swipe
        li.addEventListener('touchstart', handleTouchStart, false);
        li.addEventListener('touchmove', handleTouchMove, false);
        li.addEventListener('touchend', handleTouchEnd, false);
        
        li.addEventListener('click', (e) => {
          if (!e.target.classList.contains('remove-btn') && !e.target.classList.contains('swipe-delete')) {
            loadVideoById(video.id);
          }
        });
        
        const removeBtn = li.querySelector('.remove-btn');
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          removeFromPlaylist(index);
        });
        
        const swipeDelete = li.querySelector('.swipe-delete');
        swipeDelete.addEventListener('click', (e) => {
          e.stopPropagation();
          removeFromPlaylist(index);
        });
        
        playlistElement.appendChild(li);
      });
    }

    // Touch handlers for swipe actions
    function handleTouchStart(evt) {
      const touch = evt.touches[0];
      touchStartX = touch.clientX;
      currentSwipeItem = this;
      
      // Reset any previously swiped item
      document.querySelectorAll('.playlist-item.swiped').forEach(item => {
        if (item !== currentSwipeItem) {
          item.classList.remove('swiped');
        }
      });
    }

    function handleTouchMove(evt) {
      if (!currentSwipeItem) return;
      
      const touch = evt.touches[0];
      const diffX = touch.clientX - touchStartX;
      
      // Only allow left swipe (negative diffX)
      if (diffX < -20) {
        evt.preventDefault(); // Prevent scroll when swiping
      }
    }

    function handleTouchEnd(evt) {
      if (!currentSwipeItem) return;
      
      const touch = evt.changedTouches[0];
      const diffX = touch.clientX - touchStartX;
      
      // If swiped left enough, show delete button
      if (diffX < -50) {
        currentSwipeItem.classList.add('swiped');
      } else if (diffX > 50) {
        // If swiped right, hide delete button
        currentSwipeItem.classList.remove('swiped');
      }
      
      currentSwipeItem = null;
    }

    // Remove video from playlist
    function removeFromPlaylist(index) {
      playlists[currentPlaylist].splice(index, 1);
      
      if (currentVideoIndex >= index && currentVideoIndex > 0) {
        currentVideoIndex--;
      }
      
      if (playlists[currentPlaylist].length === 0) {
        currentVideoIndex = 0;
        if (isPlayerReady) {
          player.stopVideo();
        }
        updateNowPlaying();
      } else if (currentVideoIndex === index && isPlayerReady) {
        loadVideoById(playlists[currentPlaylist][currentVideoIndex].id);
      }
      
      // Save to localStorage
      savePlaylists();
      
      renderPlaylist();
    }

    // Clear playlist
    function clearPlaylist() {
      if (playlists[currentPlaylist].length === 0) return;
      
      if (confirm('Are you sure you want to clear the current playlist?')) {
        playlists[currentPlaylist] = [];
        currentVideoIndex = 0;
        
        if (isPlayerReady) {
          player.stopVideo();
        }
        
        // Save to localStorage
        savePlaylists();
        
        updateNowPlaying();
        renderPlaylist();
      }
    }

    // Create a new playlist
    function createNewPlaylist() {
      const name = prompt('Enter a name for the new playlist:');
      if (!name) return;
      
      if (playlists[name]) {
        alert('A playlist with that name already exists!');
        return;
      }
      
      playlists[name] = [];
      currentPlaylist = name;
      
      // Save to localStorage
      savePlaylists();
      
      // Update UI
      updatePlaylistSelector();
      renderPlaylist();
    }

    // Rename current playlist
    function renamePlaylist() {
      if (currentPlaylist === 'default') {
        alert('Cannot rename the default playlist!');
        return;
      }
      
      const newName = prompt('Enter a new name for the playlist:', currentPlaylist);
      if (!newName) return;
      
      if (playlists[newName]) {
        alert('A playlist with that name already exists!');
        return;
      }
      
      playlists[newName] = playlists[currentPlaylist];
      delete playlists[currentPlaylist];
      currentPlaylist = newName;
      
      // Save to localStorage
      savePlaylists();
      
      // Update UI
      updatePlaylistSelector();
    }

    // Delete current playlist
    function deletePlaylist() {
      if (currentPlaylist === 'default') {
        alert('Cannot delete the default playlist!');
        return;
      }
      
      if (!confirm(`Are you sure you want to delete the "${currentPlaylist}" playlist?`)) return;
      
      delete playlists[currentPlaylist];
      currentPlaylist = 'default';
      
      // Save to localStorage
      savePlaylists();
      
      // Update UI
      updatePlaylistSelector();
      renderPlaylist();
    }

    // Update playlist selector dropdown
    function updatePlaylistSelector() {
      playlistSelect.innerHTML = '';
      
      for (const name in playlists) {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        option.selected = name === currentPlaylist;
        playlistSelect.appendChild(option);
      }
    }

    // Save playlists to localStorage
    function savePlaylists() {
      localStorage.setItem('ytPlaylists', JSON.stringify(playlists));
      localStorage.setItem('ytCurrentPlaylist', currentPlaylist);
    }

    // Load playlists from localStorage
    function loadPlaylists() {
      const savedPlaylists = localStorage.getItem('ytPlaylists');
      const savedCurrent = localStorage.getItem('ytCurrentPlaylist');
      
      if (savedPlaylists) {
        playlists = JSON.parse(savedPlaylists);
      }
      
      if (savedCurrent && playlists[savedCurrent]) {
        currentPlaylist = savedCurrent;
      }
      
      updatePlaylistSelector();
      renderPlaylist();
    }

    // Event listeners
    addForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const inputValue = youtubeInput.value.trim();
      if (!inputValue) return;
      
      const videoId = extractVideoId(inputValue);
      if (!videoId) {
        alert('Please enter a valid YouTube URL or video ID');
        return;
      }
      
      addVideoToPlaylist(videoId);
    });

    prevButton.addEventListener('click', playPreviousVideo);
    nextButton.addEventListener('click', playNextVideo);
    playPauseButton.addEventListener('click', togglePlayPause);
    mobilePlayPauseButton.addEventListener('click', togglePlayPause);
    mobileNextButton.addEventListener('click', playNextVideo);
    
    shuffleButton.addEventListener('click', () => {
      isShuffle = !isShuffle;
      shuffleButton.classList.toggle('active', isShuffle);
    });
    
    repeatButton.addEventListener('click', () => {
      isRepeat = !isRepeat;
      repeatButton.classList.toggle('active', isRepeat);
    });
    
    clearButton.addEventListener('click', clearPlaylist);
    
    playlistSelect.addEventListener('change', () => {
      currentPlaylist = playlistSelect.value;
      currentVideoIndex = 0;
      renderPlaylist();
      updateNowPlaying();
    });
    
    createPlaylistBtn.addEventListener('click', createNewPlaylist);
    renamePlaylistBtn.addEventListener('click', renamePlaylist);
    deletePlaylistBtn.addEventListener('click', deletePlaylist);

    // Initialize
    loadPlaylists();
    updateNowPlaying();
  </script>
</body>
</html>